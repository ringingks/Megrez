<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Y3 | Control Tower - CONSOLE</title>
    <link rel="stylesheet" href="../../../../depot/SDK/layui/v2.3.0/css/layui.css" media="all">
    <script src="../../../../depot/SDK/jQuery/jquery.min.js" charset="utf-8"></script>
    <script src="../../../../depot/SDK/jQuery/jquery.form.js" charset="utf-8"></script>
    <script src="../../../../config/config.js" charset="utf-8"></script>
    <script src="../../../../depot/SDK/echarts/v4.0.4/echarts.min.js"></script>
</head>
<style>
    body {
        width: 100%;
        height: 100%;
        background: rgba(0, 191, 179, .01);
    }
    .body-card{
        width: 96%;
        margin-left: 2%;
        margin-right: 2%;
    }
    .collapse-btn-save{
        width: 25px;
        float: right;
        margin: 6px 0px 0 0;
        line-height: 30px;
    }
    .item-lable-style{
        width: 150px;
        font-weight: bold;
        text-align: left;
        margin-left: 25px;
    }
    .switch-style{
        margin-right: 125px;
        float: right;
    }
    .text-style{
        margin-right: 5px;
        min-width: 50px;
        width: 80px;
        float: right;
    }
    .uint-label{
        width: 100px;
        float: right;
        margin-right: 20px;
        line-height: 40px;
        font-size: 0.8em;
    }
    #demo{
        height: 200px;
    }
    #btn_apply_switch{
        width: 50px !important;
        position: absolute;
        z-index:999;
        margin-top: 10px;
        right: 5%;
        background: #f2f2f2;
        box-shadow: 1px 1px 1px #888888;
    }
</style>
<script type="text/javascript">
    var data = [];
    var showDeviceGroup = "";
    function initAlertRuleConf() {
        $.ajax({
            type: 'GET'
            , url: _host + "app/s01/f01/sender/conf"
            , contentType: 'application/x-www-form-urlencoded '
            , dataType: 'json'
            , async: false
            , success: function (data) {
                if (data.state && data.state === "1") {
                    var d = data.hits[0];
                    $("input[name='frequency']").val(d.frequency);
                    if(d.status===1){
                        $("input[name='status']").attr("checked", true)
                    }
                }
            },
            error: function (data) {
            }
        })
    }

    $(function(){
        initAlertRuleConf()
    })



</script>
<body>
<div class="body-card">
    <ins class="adsbygoogle" style="display:inline-block;width:970px;height:90px"
         data-ad-client="ca-pub-6111334333458862" data-ad-slot="3820120620"></ins>
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 15px;">
        <legend>HPB : Temperature Excursion Management</legend>
    </fieldset>

    <div class="layui-collapse" lay-filter="testCollapse">
        <div class="layui-colla-item">
            <button class="layui-btn layui-btn-xs layui-btn-primary" id="btn_apply_switch">Apply</button>
            <h2 class="layui-colla-title">
                ALERT SENDER
                <!--<div id="alert_sender" class="collapse-btn-save"><i class="layui-icon layui-icon-more-vertical"></i></div>-->
            </h2>

            <div class="layui-colla-content layui-show">

                <div class="layui-form" lay-filter="mainConf">
                    <div class="layui-form-item" name="status">
                        <label class="layui-form-label item-lable-style">SENDER SWITCH</label>
                        <div class="layui-input-block switch-style">
                            <input type="checkbox" name="status" lay-skin="switch" lay-filter="statusEvent" lay-text="ACTIVE|DEACTIVE">
                        </div>
                    </div>

                    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 15px;">
                    </fieldset>

                    <div class="layui-form-item" name="frequency">
                        <label class="layui-form-label item-lable-style">FREQUENCY</label>
                        <div class="layui-input-block">
                            <label class="uint-label">(UNIT: Second)</label>
                            <input type="text" name="frequency" autocomplete="off" placeholder="" class="text-style layui-input">
                        </div>

                    </div>
                </div>

            </div>
        </div>

        <div class="layui-colla-item">
            <h2 class="layui-colla-title">Keeper</h2>
            <div class="layui-colla-content layui-show">
                <table class="layui-table" lay-data="{height: '270',page:false ,url:_host+'app/s01/f01/keepers' ,id:'ds_user'}" lay-filter="userTableEvent">
                    <thead>
                    <tr>
                        <!--<th lay-data="{field:'alertlev', width:10 ,sort:true ,style:'display: none;'}">alertlev</th>-->
                        <th lay-data="{field:'groupname', width:220, sort: true ,style:'cursor: pointer;'}">LEV DESCRIPTION</th>
                        <th lay-data="{field:'keeper' ,width:'180' ,style:'cursor: pointer;'}">NOTICE MEMBER</th>
                        <th lay-data="{field:'tel' ,width:'220' ,style:'cursor: pointer;'}">TEL</th>
                        <th lay-data="{field:'email', width:320, sort: true ,style:'cursor: pointer;'}">E-MAIL</th>
                        <!--<th lay-data="{fixed: 'right', width:'200', align:'center', toolbar: '#barDemo'}"></th>-->
                    </tr>
                    </thead>
                </table>
            </div>
        </div>

        <div class="layui-colla-item">
            <h2 class="layui-colla-title">Temperature Axis</h2>
            <div class="layui-colla-content layui-show">
                <div id="demo"></div>
            </div>
        </div>

    </div>

</div>
</body>
<script type="text/javascript">

    function initLast30MinsData() {
        var data = []
        $.ajax({
            type: 'GET'
            , url: _host + "app/s01/f01/sender/data"
            , contentType: 'application/x-www-form-urlencoded '
            , dataType: 'json'
            , async: false
            , success: function (result) {
                var hits = result.hits;
                var key;
                for(key in hits){
                    var hit;
                    eval("hit = hits."+key)
                    for(var i=0;i<hit.length;i++){
                        var item = hit[i]
                        var d = {}
                        d.name = item.reporttime;
                        d.value = [item.reporttime,item.temp]
                        d.sourcedata = item
                        data.push(d)
                    }
                    if(hit){
                        break;
                    }
                }
            }
        })
        return data;
    }

    data = initLast30MinsData();
    showDeviceGroup = data[0].sourcedata.devicegroup

    function refrshLastRec(){
        var data;
        $.ajax({
            type: 'GET'
            , url: _host + "app/s01/f01/sender/last"
            , contentType: 'application/x-www-form-urlencoded '
            , dataType: 'json'
            , async: false
            , success: function (result) {
                var hits = result.hits;
                console.log(44,hits)
                for(var i=0;i<hits.length;i++){
                    var item = hits[i];
                    if(item.devicegroup === showDeviceGroup){
                        data = item;
                        break;
                    }
                }
                console.log(44,data)
            }
        })

        return {
            name: data.reporttime
            ,value:[data.reporttime ,data.temp]
            ,sourcedata: data
        }
    }

    var myChart;

    function initEchart(divid,data) {

        myChart = echarts.init(document.getElementById(divid));

        console.log(22,data)
        // showDeviceGroup = data[0].sourcedata.devicegroup

        option = {
            title: {
                text: 'Devices['+showDeviceGroup+'] Temp Monitoring'
            },
            tooltip: {
                trigger: 'axis',
                formatter: function (params) {
                    params = params[0];
                    return params.name +"<br />"+params.value[1]+"℃"
                },
                axisPointer: {
                    animation: false
                }
            },
            xAxis: {
                type: 'time',
                splitLine: {
                    show: false
                }
            },
            yAxis: {
                type: 'value',
                boundaryGap: [0, '100%'],
                splitLine: {
                    show: false
                }
            },
            visualMap: {
                top: 10,
                right: 10,
                pieces: [{
                    gt: 0,
                    lte: 2,
                    color: '#096'
                }, {
                    gt: 2,
                    lte: 2.5,
                    color: '#ffde33'
                }, {
                    gt: 2.5,
                    lte: 3.0,
                    color: '#ff9933'
                }, {
                    gt: 3.0,
                    lte: 6.5,
                    color: '#cc0033'
                }, {
                    gt: 6.5,
                    lte: 7.5,
                    color: '#660099'
                }, {
                    gt: 7.5,
                    color: '#7e0023'
                }],
                outOfRange: {
                    color: '#999'
                }
            },
            series: [{
                name: 'Temperature',
                type: 'line',
                showSymbol: false,
                hoverAnimation: false,
                data: data
            }]
        };

        setInterval(function () {

            data.shift();
            data.push(refrshLastRec());

            myChart.setOption({
                series: [{
                    data: data
                }]
            });
        }, 60000);

        if (option && typeof option === "object") {
            myChart.setOption(option, true);
        }
    }

    initEchart("demo",data);


</script>
<script src="../../../../depot/SDK/layui/v2.3.0/layui.js" charset="utf-8"></script>
<script type="text/javascript">

    $("#btn_apply_switch").on('click',function () {
        alert(21212)
    })

    layui.use(['element', 'layer'], function () {
        var element = layui.element;

        element.on('collapse(testCollapse)', function(data){
            // console.log(data.show); //得到当前面板的展开状态，true或者false
            // console.log(data.title); //得到当前点击面板的标题区域DOM对象
            // console.log(data.content.children("#demo")); //得到当前点击面板的内容区域DOM对象

            if(data.show){
                myChart.setOption(option,true)
            }
        });

    })

    layui.use('form', function () {
        var form = layui.form;
    })

    layui.use('table', function () {
        var table = layui.table;
    })
</script>


</html>